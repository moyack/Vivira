/* PortaMx Forum - @package PortaMx - @author PortaMx @copyright 2018 PortaMx and individual contributors */
(function(a){a.extend(!0,a.sceditor.prototype,{InsertText:function(c,d){var f=this.inSourceMode();c.endsWith('[/quote]')&&(c+='\n '),f||this.toggleSourceMode();var g=d?c:this.getSourceEditorValue(!1)+c;this.setSourceEditorValue(g),f||this.toggleSourceMode()},getText:function(c){var d='';return d=this.inSourceMode()?this.getSourceEditorValue(!1):this.getWysiwygEditorValue(c),d},appendEmoticon:function(c,d){''===d?line.append(a('<br />')):($img=a('<img />').attr({src:d.url||d,alt:c,title:d.tooltip||d}).on('click',function(f){var g='',h='';base.opts.emoticonsCompat&&(g='<span> ',h=' </span>'),base.inSourceMode()?base.sourceEditorInsertText(' '+a(this).attr('alt')+' '):base.wysiwygEditorInsertHtml(g+'<img src="'+a(this).attr('src')+'" data-sceditor-emoticon="'+a(this).attr('alt')+'" />'+h),f.preventDefault()}),$wrapper=a('<span class="smiley"></span>').append($img),line.append($wrapper))},storeLastState:function(){this.wasSource=this.inSourceMode()},setTextMode:function(){this.inSourceMode()||this.toggleSourceMode()},createPermanentDropDown:function(){var c=a.extend({},this.opts.emoticons.dropdown);base=this,content=a('<div class="sceditor-insertemoticon" />'),line=a('<div id="sceditor-smileycontainer" />'),a.isEmptyObject(this.opts.emoticons.popup)||(this.opts.emoticons.more=this.opts.emoticons.popup,moreButton=a('<div class="sceditor-more" />').text(this._('More')).on('click',function(){var d=a('.sceditor-smileyPopup');if(0<d.length)d.fadeIn('fast');else{var f=a.extend({},base.opts.emoticons.popup),g=a('<div class="category_header sceditor-popup-grip"/>');popupContent=a('<div id="sceditor-popup" />'),line=a('<div id="sceditor-popup-smiley" />'),popupContent.append(g),a.each(f,base.appendEmoticon),0<line.children().length&&popupContent.append(line),closeButton=a('<div id="sceditor-popup-close" />').text('['+popup_close+']').on('click',function(){a('.sceditor-smileyPopup').fadeOut('fast')}),'undefined'!=typeof closeButton&&popupContent.append(closeButton),!1!==base.ieUnselectable&&(content=a(content),content.find(':not(input,textarea)').filter(function(){return 1===this.nodeType}).attr('unselectable','on')),$dropdown=a('<div class="sceditor-dropdown sceditor-smileyPopup" />').append(popupContent).appendTo('.sceditor-toolbar').css({top:'1px',left:'1px'}),dropdownIgnoreLastClick=!0,$dropdown.on('click',function(h){h.stopPropagation()})}})),a.each(c,base.appendEmoticon),0<line.children().length&&content.append(line),a('.sceditor-toolbar').append(content),'undefined'!=typeof moreButton&&content.append(moreButton)}})})(jQuery),$.sceditor.command.set('pre',{tooltip:'Pre',txtExec:['[pre]','[/pre]'],exec:function(){this.wysiwygEditorInsertHtml('<pre>','</pre>')}}),$.sceditor.command.set('email',{txtExec:function(a,b){var c=b&&-1<b.indexOf('@')?null:b,d=prompt(this._('Enter the e-mail address:'),c?'':b);if(d){var f=prompt(this._('Enter the displayed text:'),c||d)||d;this.insertText('[email='+d+']'+f+'[/email]')}}}),$.sceditor.command.set('link',{txtExec:function(a,b){var c=b&&(-1<b.indexOf('http://')||-1<b.indexOf('https://'))?null:b,d=prompt(this._('Enter URL:'),c?'http://':b);if(d){var f=prompt(this._('Enter the displayed text:'),c||d)||d;this.insertText('[url='+d+']'+f+'[/url]')}}}),$.sceditor.command.set('bulletlist',{txtExec:function(a,b){if(b){var c='';$.each(b.split(/\n/),function(){this.replace(/^\n/,''),this.replace(/\n$/,''),c+='[li]'+this+'[/li]'}),this.insertText('[list]\n'+c+'\n[/list]')}else this.insertText('[list]\n[li]','[/li][li][/li]\n[/list]')}}),$.sceditor.command.set('orderedlist',{txtExec:function(a,b){if(b){var c='';$.each(b.split(/\n/),function(){c+='[li]'+this+'[/li]'}),this.insertText('[list type=decimal]\n'+c+'\n[/list]')}else this.insertText('[list type=decimal]\n[li]','[/li][li][/li]\n[/list]')}}),$.sceditor.command.set('table',{txtExec:['[table]\n[tr]\n[td]','[/td]\n[/tr]\n[/table]']}),$.sceditor.plugins.bbcode.bbcode.set('abbr',{tags:{abbr:{title:null}},format:function(a,b){return'[abbr='+a.attr('title')+']'+b+'[/abbr]'},html:function(a,b,c){return'undefined'==typeof b.defaultattr||0===b.defaultattr.length?c:'<abbr title="'+b.defaultattr+'">'+c+'</abbr>'}}),$.sceditor.plugins.bbcode.bbcode.set('member',{html:function(a,b,c){return'undefined'==typeof b.defaultattr||0===b.defaultattr.length?c:'@'+c}}),$.sceditor.plugins.bbcode.bbcode.set('list',{breakStart:!1,isInline:!1,allowedChildren:['*','li'],html:function(a,b,c){var d='',f='ul';return b.type&&(d=' style="list-style-type: '+b.type+'"'),c=c.replace(/<br[^>]*><li>/g,'<li>'),c=c.replace(/<li><br[^>]*>/g,'<li>'),c=c.replace(/<br[^>]*><\/li>/g,'</li>'),c=c.replace(/<\/li><br[^>]*>/g,'</li>'),c=c.replace(/^<br[^>]*>/,''),c=c.replace(/<br[^>]*>$/,''),'<'+f+d+'>'+c+'</'+f+'>'}}),$.sceditor.plugins.bbcode.bbcode.set('ul',{tags:{ul:null},breakStart:!1,isInline:!1,html:function(a,b,c){return'<ul>'+c+'</ul>'},format:function(a,b){return b=b.replace(/\[li\]\n/g,'[li]'),b=b.replace(/\n\[\/li\]/g,'[li]'),b=b.replace(/\n\[li\]/g,'[li]'),b=b.replace(/\[\/li\]\n/g,'[li]'),''==$(a[0]).css('list-style-type')?'[list]'+b.replace(/\n$/,'')+'[/list]':'[list type='+$(a[0]).css('list-style-type')+']'+b.replace(/\r$/,'')+'[/list]'}}),$.sceditor.plugins.bbcode.bbcode.set('ol',{tags:{ol:null},breakStart:!1,isInline:!1,format:'[list type=decimal]{0}[/list]',html:'<ol>{0}</ol>'}),$.sceditor.plugins.bbcode.bbcode.set('img',{tags:{img:{src:null}},allowsEmpty:!0,quoteType:$.sceditor.BBCodeParser.QuoteType.never,format:function(a,b){var c='',d=function(f){return a.style?a.style[f]:null};return a.attr('data-attachment')?(a.attr('name')&&(c+=' name='+a.attr('name')),a.attr('type')&&(c+=' type='+a.attr('type')),a.attr('width')&&(c+=' width='+a.attr('width')),a.attr('height')&&(c+=' height='+a.attr('height')),a.attr('alt')&&(c+=' alt='+a.attr('alt')),a.attr('title')&&(c+=' title='+a.attr('title')),a.attr('expand')&&(c+=' expand='+a.attr('expand')),'[attach'+c+']'+a.attr('data-attachment')+'[/attach]'):'undefined'==typeof a.attr('data-sceditor-emoticon')?((a.attr('width')||d('width'))&&(c+=' width='+$(a).width()),(a.attr('height')||d('height'))&&(c+=' height='+$(a).height()),a.attr('alt')&&(c+=' alt='+a.attr('alt')),a.attr('title')&&(c+=' title='+a.attr('title')),a.attr('expand')&&(c+=' expand='+a.attr('expand')),'[img'+c+']'+a.attr('src')+'[/img]'):b},html:function(a,b,c){var f='';return'undefined'!=typeof b.width&&(f+=' width="'+b.width+'"'),'undefined'!=typeof b.height&&(f+=' height="'+b.height+'"'),'undefined'!=typeof b.alt&&(f+=' alt="'+b.alt+'"'),'undefined'!=typeof b.title&&(f+=' title="'+b.title+'"'),'undefined'!=typeof b.expand&&(f+=' expand="'+b.expand+'"'),'<img'+f+' src="'+c+'" style="vertical-align:top">'}}),$.sceditor.plugins.bbcode.bbcode.set('attach',{tags:{attach:{src:null}},allowsEmpty:!0,quoteType:$.sceditor.BBCodeParser.QuoteType.never,format:function(a,b){var c='',d=function(f){return a.style?a.style[f]:null};return(a.attr('width')||d('width'))&&(c+=' width='+$(a).width()),(a.attr('height')||d('height'))&&(c+=' height='+$(a).height()),a.attr('alt')&&(c+=' alt='+a.attr('alt')),a.attr('title')&&(c+=' title='+a.attr('title')),a.attr('name')&&(c+=' name='+a.attr('name')),a.attr('expand')&&(c+=' expand='+a.attr('expand')),a.attr('type')&&(c+=' type='+a.attr('type')),'[attach'+c+']'+b+'[/attach]'},html:function(a,b,c){var f='';'undefined'!=typeof b.width&&(f+=' width="'+b.width+'"'),'undefined'!=typeof b.height&&(f+=' height="'+b.height+'"'),'undefined'!=typeof b.alt&&(f+=' alt="'+b.alt+'"'),'undefined'!=typeof b.title&&(f+=' title="'+b.title+'"'),f+=' name="'+b.name+'"','undefined'!=typeof b.expand&&(f+=' expand="'+b.expand+'"'),'undefined'!=typeof b.type&&(f+=' type="'+b.type+'"'),'undefined'!=typeof b.name&&(f+=' name="'+b.name+'"');var g=pmx_scripturl+'?action=dlattach;attach='+c+';type=preview;thumb';if(contentIMG=new Image,contentIMG.src=g,'undefined'!=typeof b.type&&!b.type.match(/image.*/)||0==contentIMG.getAttribute('width')){var h='';return'undefined'!=typeof b.name&&(h=' name="'+b.name+'"'),'<a href="'+pmx_scripturl+'?action=dlattach;attach='+c+';type=preview;file" data-attachment="'+c+'"'+h+'>'+('undefined'==typeof b.name?c:b.name)+'</a>'}return'<img'+f+' src="'+g+'" data-attachment="'+c+'" style="vertical-align:top">'}}),$.sceditor.plugins.bbcode.bbcode.set('sigurl',{allowsEmpty:!0,quoteType:$.sceditor.BBCodeParser.QuoteType.never,tags:{a:{href:null}},format:function(a,b){return b},html:function(a,b,c){return('undefined'==typeof b.defaultattr||0===b.defaultattr.length)&&(b.defaultattr=c),'<a target="_blank" rel="noopener" href="'+encodeURI(b.defaultattr)+'" class="video">'+c+'</a>'}}),$.sceditor.plugins.bbcode.bbcode.set('iurl',{allowsEmpty:!0,quoteType:$.sceditor.BBCodeParser.QuoteType.never,html:function(a,b,c){return('undefined'==typeof b.defaultattr||0===b.defaultattr.length)&&(b.defaultattr=c),-1===encodeURI(b.defaultattr).indexOf(pmx_boardurl.substring(0,pmx_boardurl.length-1))?'<a target="_blank" rel="noopener" href="'+encodeURI(b.defaultattr)+'">'+c+'</a>':'<a href="'+encodeURI(b.defaultattr)+'">'+c+'</a>'}}),$.sceditor.plugins.bbcode.bbcode.set('url',{allowsEmpty:!0,quoteType:$.sceditor.BBCodeParser.QuoteType.never,tags:{a:{href:null}},format:function(a,b){var c=a.attr('href');if(a.attr('class')!==void 0&&'nobbc'==a.attr('class'))return'[sigurl='+decodeURI(c)+' class=nobbc]'+b+'[/sigurl]';return'mailto:'===c.substr(0,7)?'[email='+c.substr(7)+']'+b+'[/email]':'ftp'===c.substr(0,3)?'[ftp='+c+']'+b+'[/ftp]':void 0!==a.attr('target')||-1===decodeURI(c).indexOf(pmx_boardurl.substring(0,pmx_boardurl.length-1))?'[url='+decodeURI(c)+']'+b+'[/url]':'[iurl='+decodeURI(c)+']'+b+'[/iurl]'},html:function(a,b,c){return('undefined'==typeof b.defaultattr||0===b.defaultattr.length)&&(b.defaultattr=c),1===encodeURI(b.defaultattr).indexOf(pmx_boardurl.substring(0,pmx_boardurl.length-1))?'<a target="_blank" rel="noopener" href="'+encodeURI(b.defaultattr)+'">'+c+'</a>':'<a href="'+encodeURI(b.defaultattr)+'">'+c+'</a>'}}),$.sceditor.plugins.bbcode.bbcode.set('pre',{tags:{pre:null},isBlock:!0,format:'[pre]{0}[/pre]',html:'<pre>{0}</pre>\n'}),$.sceditor.plugins.bbcode.bbcode.set('php',{breakBefore:!1,breakStart:!0,breakEnd:!0,breakAfter:!0,isInline:!1,format:function(a,b){var c=/\t/gm;return b=b.replace(c,'        '),'[php]'+b.replace('&#91;','[')+'[/php]'},html:function(a,b,c){var d=/\t/gm;return c=c.replace(d,'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'),'<code class="php">'+c+'</code>'}}),$.sceditor.plugins.bbcode.bbcode.set('code',{tags:{code:null},breakBefore:!1,breakStart:!0,breakEnd:!0,breakAfter:!0,isInline:!1,format:function(a,b){var c=/\t/gm;if(b=b.replace(c,'        '),$(a[0]).hasClass('php')){do cLen=b.length,b=b.replace(/^\n/,''),b=b.replace(/\n$/,'');while(cLen!=b.length);return'[php]'+b.replace('&#91;','[')+'[/php]'}do cLen=b.length,b=b.replace(/^\n/,''),b=b.replace(/\n$/,'');while(cLen!=b.length);return'[code]'+b.replace('&#91;','[')+'[/code]'},html:function(a,b,c){var d=/\t/gm;return c=c.replace(d,'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'),'<code>'+c+'</code>'}}),$.sceditor.plugins.bbcode.bbcode.set('quote',{tags:{blockquote:null,cite:null},quoteType:$.sceditor.BBCodeParser.QuoteType.never,breakBefore:!1,breakAfter:!0,breakEnd:!1,isInline:!1,format:function(a,b){if('cite'===a[0].tagName.toLowerCase())return'';do cLen=b.length,b=b.replace(/^\n/,''),b=b.replace(/\n$/,''),b=b.replace(/\[\/qoute\]\n/,'[/quote]'),b=b.replace(/\[qoute\]\n/,'[quote]'),b=b.replace(/\[qoute\]\s/,'[quote]');while(cLen!=b.length);var g='[quote';return a.attr('author')&&(g+=' author='+a.attr('author').php_unhtmlspecialchars()),a.attr('link')&&(g+=' link='+a.attr('link')),a.attr('date')&&(g+=' date='+a.attr('date')),g+=']\n'+b+'\n[/quote]'},html:function(a,b,c){var d='',f='',g='';for(var h in'undefined'!=typeof b.date&&''!==b.date&&0<b.date?sDate='<date timestamp="'+b.date+'">'+pmxCookie('get','time',b.date,'format')+'</date>':(b.date='',sDate=''),b)'link'==h.substr(0,4)&&b.hasOwnProperty(h)&&''!=b[h]&&(f=4<h.length?h.substr(5)+'='+b[h]:b[h],g='http://'==f.substr(0,7)||'https://'==f.substr(0,8)?f:pmx_scripturl+'?'+f);b.author=d='undefined'==typeof b.author?'':b.author,''==d&&''==sDate?d=bbc_quote:''!=d&&''!=sDate?d=bbc_quote_from+': '+d+bbc_search_on:''!=d&&''==sDate?d=bbc_quote_from+': '+d:''==d&&''!=sDate&&(d=bbc_quote+bbc_search_on);do cLen=c.length,c=c.replace(/^<br[^>]*>/,''),c=c.replace(/<br[^>]*>$/,'');while(cLen!=c.length);return'<blockquote author="'+b.author+'" date="'+b.date+'" link="'+f+'"><cite>'+d+sDate+'</cite>'+c+'</blockquote>'}}),$.sceditor.plugins.bbcode.bbcode.set('font',{format:function(a,b){var c;return a.is('font')&&(c=a.attr('face'))||(c=a.css('font-family')),c=c.replace(/['"]/g,''),'[font='+c+']'+b+'[/font]'}}),$.sceditor.plugins.bbcode.bbcode.set('youtube',{allowsEmpty:!0,tags:{iframe:null},format:function(a){return ytpID=a[0].dataset.youtubeId,ytpID.replace(/\//g,'').trim(),'[youtube]'+ytpID.replace(/\s+|\//g,'')+'[/youtube]'},html:function(a,b,c){return lngID=$.sceditor.defaultOptions.locale.substr(0,2).trim(),ytpID=c.replace(/<br[^>]*>/g,'').trim(),'<iframe id="ytplayer" type="text/html" width="265" height="auto" style="margin-top:7px;" frameborder="0" allowfullscreen="true" src="https://www.youtube.com/embed/'+ytpID+'?iv_load_policy=3&modestbranding=0&showinfo=0&rel=0&controls=2&hl='+lngID+'" data-youtube-id="'+ytpID+'"></iframe>'}}),$.sceditor.command.set('youtube',{_dropDown:function(a,b){var c,d;c=$('<div><label for="link">'+a._('Video URL:')+'</label> <input type="text" id="videourl" placeholder="https://" value="" /></div><div><input type="button" class="button" value="'+a._('Insert')+'" /></div>'),c.find('.button').click(function(g){d=c.find('#videourl').val(),''!==d&&(videotag=d.substr(d.lastIndexOf('/')+1),videotag.trim(),a.insert('[youtube]'+videotag+'[/youtube]')),a.closeDropDown(!0),g.preventDefault()}),a.createDropDown(b,'insertvideo',c)},exec:function(a){$.sceditor.command.get('youtube')._dropDown(this,a)},txtExec:function(a){$.sceditor.command.get('youtube')._dropDown(this,a)},tooltip:'Insert a video'});
